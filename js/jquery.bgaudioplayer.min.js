/* ==========================================================================
   HTML5 background audio player 
   http://www.dynamicdrive.com/ for full source code
   ========================================================================== */
jQuery.noConflict();var bgaudioplayer=function(a){function d(d){function o(a){var b=new RegExp(a+"=[^;]+","i");return document.cookie.match(b)?document.cookie.match(b)[0].split("=")[1]:null}function p(a,b){document.cookie=a+"="+b+"; path=/"}var e=a.extend({},c,d),f=e.persistTimeLine;delete e.persistTimeLine;var g=document.getElementById(e.audioid),h=a("#"+e.audiointerface),i=this;if(!b)return void h.hide();if(f){if(o("persist_"+e.audioid)){try{var j=o("persist_"+e.audioid).split("|")}catch(a){var j=[0,1,.1]}j={timeline:parseInt(j[0]),ispaused:!!parseInt(j[1]),volume:parseFloat(j[2])},e.autoplay=!j.ispaused,e.volume=j.volume,j.timeline>0&&!j.ispaused&&(g.load(),e.autoplay=!1,a(g).on("loadeddata",function(){g.currentTime=j.timeline,g.play()}))}a(window).on("unload",function(){p("persist_"+e.audioid,g.currentTime+"|"+(g.paused?1:0)+"|"+g.volume)})}for(prop in e)e.hasOwnProperty(prop)&&(g[prop]=e[prop]);e.autoplay&&g.play("play"),this.playfile=function(a){if("pause"==a?g.pause():"play"==a?g.play():"rewind"==a?(g.currentTime=0,this.playfile()):g.paused?g.play():g.pause(),1==k.length){var b=k.data("specs").controltype,c=k.data("specs").controlvals;k.attr("title",g.paused?"Играть":"Пауза").get(0)[b]=g.paused?c[0]:c[1]}},this.setvolume=function(a,b){""!=a&&(g.volume="number"==typeof a?a:g.volume+new Number(a),n.removeClass("on").slice(0,a*e.volumelevels).addClass("on"),m.css({opacity:.5}).animate({opacity:1},70)),b&&n.removeClass("on").slice(0,b*e.volumelevels).addClass("on")};var k=function(){var a=h.find(".play:eq(0)"),b=f&&j?!j.ispaused:e.autoplay,c=a.is("img")?"src":a.is('input[type="button"]')?"value":"innerHTML";"src"==c&&a.data("playsrc",a.attr("src"));var d="src"==c?[a.data("playsrc"),a.data("pausesrc")]:["Играть","Пауза"];return b&&(a.get(0)[c]=d[1]),a.click(function(){i.playfile()}),a.attr("title",b?"Pause":"Play").data("specs",{controltype:c,controlvals:d}),a}(),m=(h.find(".rewind:eq(0)").attr("title","Rewind").on("click",function(){i.playfile("rewind")}),h.find("div.volume:eq(0)").css({display:"inline-block"}).html(function(){for(var a="",b=1;b<=e.volumelevels;b++)a+='<div data-vol="'+b/e.volumelevels+'" title="Set volume: '+Math.round(b/e.volumelevels*100)+'%"></div>';return a}()).on("mouseover",function(a){a.target.getAttribute("data-vol")&&i.setvolume("",a.target.getAttribute("data-vol"))}).on("mouseleave",function(){i.setvolume("",g.volume)}).on("click",function(a){a.target.getAttribute("data-vol")&&i.setvolume(parseFloat(a.target.getAttribute("data-vol")))})),n=m.find("div");return this.setvolume(g.volume),this}var b=!!document.createElement("audio").canPlayType,c={autoplay:!0,loop:!0,persistTimeLine:!1,volume:.5,volumelevels:10};return d}(jQuery);